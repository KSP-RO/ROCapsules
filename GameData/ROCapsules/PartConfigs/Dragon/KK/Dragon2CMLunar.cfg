PART
{
	name = ROC-Dragon2CMLunar
	module = Part
	author = Kartoffelkuchen, Vader111

	RSSROConfig = True

	//  ============================================================================
	//  Model and Dimensions
	//  ============================================================================

	MODEL 
	{
		model = ROCapsules/Assets/KK/Dragon/Dragon2CM
	}

	INTERNAL
	{
		name = ROC-Dragon2CMLunarInterior
	}

	scale = 1.0
	rescaleFactor = 1.0

	node_stack_top = 0.0, 1.880697, 0.0, 0.0, 1.0, 0.0, 1
	node_stack_bottom = 0.0, -1.600847, 0.0, 0.0, -1.0, 0.0, 3
	node_stack_mainChutes = 0.0, 1.481525, -1.557307, 0.0, 1.0, 0.0, 2
	node_stack_drogueCover = 0.0, 1.2, -1.0, 0.0, 1.0, 0.0, 2
	node_stack_mainCover = 0.0, 0.0, -1.5, 0.0, 1.0, 0.0, 2

	CoPOffset = 0.0, 1.0, 0.0
	CoMOffset = 0.0, -0.325, 0.0
	CoLOffset = 0.0, -0.45, 0.0
	CenterOfBuoyancy = 0.0, 1.5, 0.0
	CenterOfDisplacement = 0.0, 0.5, 0.0
	buoyancyUseSine = False
	buoyancy = 1.1

	attachRules = 1,0,1,1,0

	//  ============================================================================
	//  Title, Description, Category, Techs
	//  ============================================================================

	TechRequired = unlockParts
	cost = 150
	entryCost = 1
	category = Pods
	subcategory = 0
	title = Crew Dragon Capsule (Lunar)
	manufacturer = SpaceX
	description = SpaceXâ€™s next-generation Dragon V2 spacecraft designed to carry humans to the Moon and Back.
	tags = Spacex, Dragon, Crew, Lunar

	vesselType = Ship
	stagingIcon = COMMAND_POD
	CrewCapacity = 3
	bulkheadProfiles = size2, size1

	//  ============================================================================
	//  Thermo, Durability
	//  ============================================================================

	mass = 7.0
	dragModelType = default
	breakingForce = 250
	breakingTorque = 250
	maximum_drag = 0.20
	minimum_drag = 0.15
	angularDrag = 2
	crashTolerance = 12
	maxTemp = 973.15
	skinMaxTemp = 2673.15
	emissiveConstant = 0.6
	thermalMassModifier = 1.0
	skinMassPerArea = 4
	bodyLiftOnlyUnattachedLift = True
	bodyLiftOnlyAttachName = bottom

	//  ============================================================================
	//  Animations and Textures
	//  ============================================================================

	EFFECTS
	{
		running1
		{
			AUDIO_MULTI_POOL
			{
				channel = Ship
				transformName = draco
				clip = sound_rocket_mini
				volume = 0.0 0.0
				volume = 0.02 0.1
				volume = 0.5 0.1
				volume = 1.0 0.1
				pitch = 0.0 0.75
				pitch = 1.0 1.5
				loop = true
			}
			MODEL_MULTI_PARTICLE
			{
				modelName = Squad/FX/Monoprop_small
				transformName = draco
				emission = 0.0 0.0
				emission = 0.1 0.0
				emission = 1.0 1.0
				speed = 0.0 0.8
				speed = 1.0 1.0
				localRotation = -90, 0, 0
			}
		}
		running2
		{
			AUDIO_MULTI_POOL
			{
				channel = Ship
				transformName = draco_top
				clip = sound_rocket_mini
				volume = 0.0 0.0
				volume = 0.02 0.1
				volume = 0.5 0.1
				volume = 1.0 0.1
				pitch = 0.0 0.75
				pitch = 1.0 1.5
				loop = true
			}
			MODEL_MULTI_PARTICLE
			{
				modelName = Squad/FX/Monoprop_small
				transformName = draco_top
				emission = 0.0 0.0
				emission = 0.1 0.0
				emission = 1.0 1.0
				speed = 0.0 0.8
				speed = 1.0 1.0
				localRotation = -90, 0, 0
			}
		}
	}

	//  ============================================================================
	//  Modules and Resources
	//  ============================================================================

	MODULE
	{
		name = ModuleCommand
		minimumCrew = 0
		hasHibernation = True
		hibernationMultiplier = 0.625
		defaultControlPointDisplayName = Default
		CONTROLPOINT
		{
			name = reverse
			displayName = Reversed
			orientation = 0,0,180
		}
		RESOURCE
		{
			name = ElectricCharge
			rate = 1.6
		}
	}

	MODULE
	{
		name = ModuleSAS
		SASServiceLevel = 3
	}

	MODULE
	{
		name = AdjustableCoMShifter
		DescentModeCoM = 0, 0, -0.19
	}

	MODULE
	{
		name = ModuleAnimateGeneric
		animationName = KK_SpXCD_nosecone
		actionGUIName = Toggle Cone
		startEventGUIName = Open Cone
		endEventGUIName  = Close Cone
		layer = 0
	}

	MODULE
	{
		name = ModuleAnimateGeneric
		animationName = KK_SpXCD_windows
		actionGUIName = Toggle Lights
		startEventGUIName = Lights On
		endEventGUIName = Lights Off
		toggleAction = True
		defaultActionGroup = Light
		layer = 2
	}

	MODULE
	{
		name = ModuleScienceExperiment
		experimentID = crewReport
		experimentActionName = Crew Report
		resetActionName = Discard Crew Report
		reviewActionName = Review Report
		useStaging = False
		useActionGroups = True
		hideUIwhenUnavailable = True
		rerunnable = True
		xmitDataScalar = 1.0
		usageReqMaskInternal = 5
		usageReqMaskExternal = -1
	}

	MODULE
	{
		name = ModuleScienceContainer
		reviewActionName = Review Stored Data
		storeActionName = Store Experiments
		storageRange = 2.0
		canBeTransferredToInVessel = True
		canTransferInVessel = True
	}

	MODULE
	{
		name = ModuleLiftingSurface
		useInternalDragModel = False
		deflectionLiftCoeff = 1.4
		liftingSurfaceCurve = CapsuleBottom
		disableBodyLift = False
		omnidirectional = False
		perpendicularOnly = True
		transformDir = Y
		transformSign = -1
		nodeEnabled = True
		attachNodeName = bottom
	}

	MODULE
	{
		name = ModuleConductionMultiplier
		modifiedConductionFactor = 0.003
		convectionFluxThreshold = 3000
	}

	MODULE
	{
		name = ModuleEnginesRF
		engineID = Superdraco
		EngineType = LiquidFuel
		thrustVectorTransformName = SmokeTransform
		exhaustDamage = False
		throttleLocked = False
		ignitionThreshold = 0.1
		minThrust = 136
		maxThrust = 680
		heatProduction = 100
		PROPELLANT
		{
			name = MMH
			ratio = 0.5629
			DrawGauge = True
		}
		PROPELLANT
		{
			name = NTO
			ratio = 0.4371
			DrawGauge = False		
		}
		atmosphereCurve
		{
			key,0 = 0 280
			key,1 = 1 240
		}
		ullage = False
		pressureFed = True
		ignitions = 0	
		IGNITOR_RESOURCE
		{
			name = ElectricCharge
			amount = 1.0
		}
	}

	MODULE
	{
		name = FXModuleAnimateThrottle
		animationName = KK_SpXCD_superdraco
		responseSpeed = 0.001
		layer = 1
		dependOnEngineState = True
		dependOnThrottle = True
		weightOnOperational = True
	}

    MODULE
    {
        name = ModuleSurfaceFX
        thrustProviderModuleIndex = 0
        fxMax = 0.5
        maxDistance = 30
        falloff = 1.5
        thrustTransformName = SmokeTransform
    }

	MODULE
	{
		name = ModuleRCSFX
		stagingEnabled = False
		thrusterTransformName = draco
		thrusterPower = 0.4
		resourceFlowMode = STAGE_PRIORITY_FLOW
		runningEffectName = running1
		rcsEnabled = True
		enableYaw = True
		enablePitch = True
		enableRoll = True
		enableX = True
		enableY = True
		enableZ = True
		PROPELLANT
		{
			name = MMH
			ratio = 0.5629
		}
		PROPELLANT
		{
			name = NTO
			ratio = 0.4371
		}
		atmosphereCurve
		{
			key = 0 300
			key = 1 82.08
		}
	}

	MODULE
	{
		name = ModuleRCSFX
		stagingEnabled = False
		thrusterTransformName = draco_top
		thrusterPower = 0.4
		resourceFlowMode = STAGE_PRIORITY_FLOW
		runningEffectName = running2
		rcsEnabled = True
		enableYaw = False
		enablePitch = False
		enableRoll = False
		enableX = False
		enableY = False
		enableZ = True
		PROPELLANT
		{
			name = MMH
			ratio = 0.5629
		}
		PROPELLANT
		{
			name = NTO
			ratio = 0.4371
		}
		atmosphereCurve
		{
			key = 0 300
			key = 1 82.08
		}
	}

	MODULE
	{
		name = ModuleFuelTanks
		type = ServiceModule
		volume = 1140.5
		basemass = -1
		TANK
		{
			name = MMH
			amount = 637.5
			maxAmount = 637.5
			isTweakable = False
		}
		TANK
		{
			name = NTO
			amount = 502.5
			maxAmount = 502.5
			isTweakable = False
		}
		TANK
		{
			name = ElectricCharge
			amount = 50000
			maxAmount = 50000
			isTweakable = False
		}
	}

}

//  ================================================================================
//  Configure RealAntennas
//  ================================================================================

@PART[ROC-Dragon2CMLunar]:BEFORE[RealAntennas]
{
	!MODULE[ModuleDataTransmitter],* {}

	MODULE
	{
		name = ModuleRealAntenna
		antennaDiameter = 0.8
		RFBand = S	//Default to S-band
	}

	MODULE
	{
		name = ModuleRealAntenna
		referenceGain = 1.5
		RFBand = UHF		//Default to UHF-band
	}
}

//  ================================================================================
//  Configure TestFlight
//  ================================================================================

@PART[ROC-Dragon2CMLunar]:HAS[!MODULE[TestFlightInterop]]:BEFORE[zTestFlight]
{
	TESTFLIGHT
	{
		name = SuperDraco
		ratedBurnTime = 350
		ignitionReliabilityStart = 0.98
		ignitionReliabilityEnd = 0.995
		cycleReliabilityStart = 0.98
		cycleReliabilityEnd = 0.995
	}
}

//  ================================================================================
//  Configure RealPlume
//  ================================================================================

@PART[ROC-Dragon2CMLunar]:BEFORE[RealPlume]
{
    PLUME_TEMPLATE
    {
        name = Hypergolic_LowerOrangeShock
        transformName = SmokeTransform
        scale = 0.16
        offset = 0
    }
}
@PART[ROC-Dragon2CMLunar]:BEFORE[zRealPlume]:NEEDS[SmokeScreen]
{
    @PLUME[Hypergolic_LowerOrangeShock]
    {
        @flareScale = 0.04
    }
}

//	==================================================
//	Dragon 2 command module.

//	TAC Life Support compatibility.
//	==================================================

@PART[ROC-Dragon2CMLunar]:AFTER[RealismOverhaul]:NEEDS[TacLifeSupport]
{
	@description ^= :$: Supports a crew of 3 for 6 days.:

    @MODULE[ModuleFuelTanks]
    {
		@volume += 328.60

        TANK
        {
            name = Food
            amount = 105.3
            maxAmount = 105.3
        }

        TANK
        {
            name = Water
            amount = 57.54
            maxAmount = 57.54
        }

        TANK
        {
            name = Oxygen
            amount = 10659.58
            maxAmount = 10659.58
        }

        TANK
        {
            name = Waste
            amount = 0
            maxAmount = 9.58
        }

        TANK
        {
            name = WasteWater
            amount = 0
            maxAmount = 88.64
        }

        TANK
        {
            name = CarbonDioxide
            amount = 0
            maxAmount = 9207.59
        }
    }

	MODULE:NEEDS[TacLifeSupport]
	{
		name = TacGenericConverter
		converterName = CO2 Vacuum Scrubber
		tag = Life Support
		StartActionName = Start CO2 Scrubber
		StopActionName = Stop CO2 Scrubber
		conversionRate = 6.0
		GeneratesHeat = False
		UseSpecialistBonus = False

		INPUT_RESOURCE
		{
			ResourceName = CarbonDioxide
			Ratio = 0.006216
			FlowMode = STAGE_PRIORITY_FLOW
		}

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.1
		}
	}
}