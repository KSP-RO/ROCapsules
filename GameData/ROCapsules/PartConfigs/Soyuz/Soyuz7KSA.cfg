//sources:
//	https://en.wikipedia.org/wiki/Soyuz_(spacecraft)#Soyuz_7K_(part_of_the_7K-9K-11K_circumlunar_complex)_(1963)
//	https://www.russianspaceweb.com/soyuz-ms.html
//	https://www.computer-museum.ru/english/argon16.htm
//	https://ntrs.nasa.gov/api/citations/20130013840/downloads/20130013840.pdf
//	https://www.gctc.ru/main.php?id=303

//	7K staging layout
//	Orbital Module: nothing??
//	Parachute: Decoupler+Parachute+RCS
//	Descent Module: Retro+(escape hatch not staged)
//	Heat Shield: Decoupler
//	SM Decoupler: Decoupler
//	Instrument section: translation thrusters (inbuilt + offset)
//	Propulsion section: Attitude control thrusters
//	KTDU-35: Engine+backup engine+fore thrusters

//Descent Module characteristics
//	7K-OK/OKS/T/TM: 2850 kg max mass (50 kg payload), 560 Watt avionics (+125 Watt SM)
//	T: 3000 kg max mass (50 kg payload), 280 Watt avionics
//	TM/TMA: 2950 kg max mass (120 kg payload), 280 Watt avionics
//	TMA-M/MS: 2950 kg max mass (140 kg payload), 105 Watt avionics
PART
{
	name = ROC-Soyuz7KSA
	module = Part
	author = tantares

	RSSROConfig = true

	MODEL
	{
		model = ROCapsules/Assets/Tantares/core_soyuz_v2/tantares_v2_crew_s1_1
	}
	MODEL
	{
		model = ROCapsules/Assets/Tantares/misc_endcaps/end_crew_s0
		scale = 1.0, 1.0, 1.0
		position = 0.0, 0.5, 0.0
	}
	scale = 1.0
	rescaleFactor = 1.736		//2.17 meters diameter

	node_stack_bottom = 0.0, -0.5, 0.0, 0.0, -1.0, 0.0, 1
	node_stack_top    = 0.0,  0.5, 0.0, 0.0, 1.0, 0.0, 0
	// stack, srfAttach, allowStack, allowSrfAttach, allowCollision
	attachRules = 1,0,1,1,0

	fx_gasBurst_white = 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, decouple
	sound_vent_large = decouple

	//CoPOffset = 0.0,  0.375,  0.0
	CoMOffset = 0.0, -0.25, 0.0 
	//CoLOffset = 0.0, -0.25,   0.0 

	CenterOfBuoyancy = 0.0, 0.5, 0.0
	CenterOfDisplacement = 0.0, -0.3, 0.0
	buoyancy = 1.5
	buoyancyUseSine = False

	//	============================================================================
	//	Title, Description, Category, Techs
	//	============================================================================

	TechRequired = unlockParts
	cost = 1
	entryCost = 1

	category     = Pods
	subcategory  = 0
	title        = Soyuz 7K Descent Module
	manufacturer = #roMfrOKB1
	description  = Descent module for the early versions of the Soyuz spacecraft. Works with Soyuz 7K-OK, 7K-T, and 7K-TM.

	tags = soyuz
	//7K SA liftoff mass varies from 2800 to 2850 kg. Aim for 2850 kg with 3 crew and 3h supplies?
	mass = 2.0736	//2850 kg - 300 kg crew - 169 kg HS - 70 kg Parachute - 5(?) kg periscope - 29.5 kg tanks dry mass - 122.9 kg LS & RCS - 50 kg misc payload? - 27 kg ablator - 3 kg Atmosphere

	dragModelType  = default
	maximum_drag   = 0.20
	minimum_drag   = 0.15
	angularDrag    = 2
	crashTolerance = 10
	fuelCrossFeed = True

	breakingTorque = 500
	breakingForce = 500

	vesselType = Ship

	CrewCapacity = 3

	//Fiberglass blankets over Titanium pressure vessel
	skinTempTag = Fiberglass
	internalTempTag = Instruments
	//override max temp since this is an ablative heat shield too
	//low enough to discourage reentry without heat shield
	skinTempOverride = 1500

	INTERNAL
	{
		name = tantares_crew_s1_1_interior
	}

	//	============================================================================
	//	Modules and Resources
	//	============================================================================

	//~2.2x1.2x0.0055 meter layer of ablative material on windward side of soyuz descent module
	//Ablative material density ~1850 kg/m^3
	//~27 kg of ablative material on windward side of soyuz descent module
	MODULE
	{
		name = ModuleAblator
		ablativeResource = Ablator
		outputResource = CharredAblator
		outputMult = 1
		lossExp = -6000
		lossConst = 0.075
		pyrolysisLossFactor = 22300
		ablationTempThresh = 750
		reentryConductivity = 0.0065
	}
	RESOURCE
	{
		name = Ablator
		maxAmount = 27
		amount = 27
	}
	RESOURCE
	{
		name = CharredAblator
		maxAmount = 27
		amount = 0
	}

	MODULE
	{
		name = ModuleInventoryPart
		InventorySlots = 4
		packedVolumeLimit = 100
	}

	MODULE
	{
		name = ModuleCommand
		minimumCrew = 0
		RESOURCE
		{
			name = ElectricCharge
			rate = 0.560	//Soyuz-T Argon-16 Avionics consume 280 watts. Twice for early analog avionics?
		}
	}

	MODULE
	{
		name = ModuleToggleCrossfeed
		crossfeedStatus = true
		toggleEditor = true
		toggleFlight = true
	}

	MODULE
	{
		name = AdjustableCoMShifter
		DescentModeCoM = 0, 0, -0.04
	}

	MODULE
	{
		name = ModuleFuelTanks
		volume = 82.2	//Soyuz is very tight. No extra space
		type = SM-III	//roughly Gemini-tier
		basemass = 2.0736
		baseCost = -1
		
		TANK
		{
			name = PotassiumSuperoxide
			amount = 34.584
			maxAmount = 39.816
		}
		TANK
		{
			name = Water
			amount = Full
			maxAmount = 1.55
		}
		TANK
		{
			name = Oxygen
			amount = Full
			maxAmount = 575.1
		}
		TANK
		{
			name = Waste
			amount = 0
			maxAmount = 2.74
		}
		TANK
		{
			name = WasteWater
			amount = 0
			maxAmount = 1.55
		}
		//idk, copied from RN Soyuz. Enough for 4 hours
		TANK
		{
			name = ElectricCharge
			amount = Full
			maxAmount = 10000
		}
		//31.4 kg HTP max load
		TANK
		{
			name = HTP
			amount = Full
			maxAmount = 21.94
		}
		//Estimated, HTP tank pressure 1.52 MPa
		//Actually nitrogen, using Helium to prevent LS from consuming
		TANK
		{
			name = Helium
			amount = Full
			maxAmount = 333.5
		}
	}

	MODULE
	{
		name = ModuleDecouple
		explosiveNodeID = top
		ejectionForce = 80

		staged = false
		menuName = Clear Escape Hatch
	}

	MODULE
	{
		name = ModuleScienceContainer
		
		reviewActionName = Review Stored Data
		storeActionName = Store Experiments
		evaOnlyStorage = True
		storageRange = 2.0
	}

	MODULE
	{
		name = FlagDecal
		textureQuadName = flag
	}

	MODULE
	{
		name = ModuleJettison
		jettisonName = jettison
		bottomNodeName = top
		isFairing = True
		jettisonedObjectMass = 0.5
		jettisonForce = 15
		jettisonDirection = 0 0 1
		stagingEnabled = False
		checkBottomNode = True
		useMultipleDragCubes = false
	}

	MODULE
	{
		name = ModuleJettison
		jettisonName = jettison
		bottomNodeName = top
		isFairing = False
		jettisonedObjectMass = 0.02
		jettisonForce = 4
		jettisonDirection = 0 0 1
		stagingEnabled = False
		checkBottomNode = False
		useMultipleDragCubes = False
		manualJettison = true
		actionSuffix = "Umbilical"
	}

	MODULE
	{
		name = ModuleColorChanger
		shaderProperty = _EmissiveColor
		animRate = 0.8
		animState = false
		useRate = true
		toggleInEditor = true
		toggleInFlight = true
		toggleInFlight = true
		unfocusedRange = 5
		toggleName = #autoLOC_502011 //#autoLOC_502011 = Toggle Lights
		eventOnName = #autoLOC_502012 //#autoLOC_502012 = Lights On
		eventOffName = #autoLOC_502013 //#autoLOC_502013 = Lights Off
		toggleAction = True
		defaultActionGroup = Light
		redCurve
		{
			key = 0 0 0 3
			key = 1 1 0 0
		}
		greenCurve
		{
			key = 0 0 0 1
			key = 1 1 1 0
		}
		blueCurve
		{
			key = 0 0 0 0
			key = 1 0.7 1.5 0
		}
		alphaCurve
		{
			key = 0 1
		}
	}

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = b9_colour
		switcherDescription = Colour

		SUBTYPE
		{
			name = c_black
			title = Black
			primaryColor = Black
			TEXTURE
			{
				texture = ROCapsules/Assets/Tantares/core_soyuz_v2/a1
				currentTexture = a1
			}
		}
		SUBTYPE
		{
			name = c_green
			title = Green
			primaryColor = Green
			TEXTURE
			{
				texture = ROCapsules/Assets/Tantares/core_soyuz_v2/a1_green
				currentTexture = a1
			}
		}
		SUBTYPE
		{
			name = c_tan
			title = Tan
			primaryColor = Tan
			TEXTURE
			{
				texture = ROCapsules/Assets/Tantares/core_soyuz_v2/a1_cream
				currentTexture = a1
			}
		}
	}
}

//	================================================================================
//	Configure RealAntennas
//	================================================================================
@PART[ROC-Soyuz7KSA]:BEFORE[RealAntennas]:NEEDS[RealAntennas]
{
	//Subtract VHF antenna mass from here to simulate VHF antenna radios
	//In reality one radio shared both antennas, so just subtract the mass of one.

	@mass -= 0.017	//Subtract 17 kg for a 20 dbm TL 4 antenna

	@MODULE[ModuleFuelTanks]
	{
		@basemass -= 0.017
	}
}
