PART
{
	name = ROC-StarshipLunarTank
	module = Part
	author = Stanley Creative, Vader111

	RSSROConfig = True

	//	============================================================================
	//	Model and Dimensions
	//	============================================================================

	MODEL
	{
		model = ROCapsules/Assets/Vader111/Starship/StarshipLunarTank
	}

	scale = 1.0
	rescaleFactor = 1.0

	node_stack_top = 0.0, 11.3839, 0.0, 0.0, 1.0, 0.0, 3
	node_stack_bottom = 0.0, -20.8054, 0.0, 0.0, -1.0, 0.0, 3

	node_stack_RaptorSrf1 = 0.82251, -17.20, 0.474137 , 0.0, -1.0, 0.0, 2
	node_stack_RaptorSrf2 = -0.82251, -17.20, 0.474137, 0.0, -1.0, 0.0, 2
	node_stack_RaptorSrf3 = 0.0, -17.20, -0.948548, 0.0, -1.0, 0.0, 2

	node_stack_RaptorVac1 = -2.6145, -16.0, -1.50787, 0.0, -1.0, 0.0, 2
	node_stack_RaptorVac2 = 2.6145, -16.0, -1.50787, 0.0, -1.0, 0.0, 2
	node_stack_RaptorVac3 = 0.0, -16.0, 3.02008, 0.0, -1.0, 0.0, 2

	CoMOffset = 0.0, -10.0, 0.0

	attachRules = 1,0,1,0,0

	//	============================================================================
	//	Title, Description, Category, Techs
	//	============================================================================

	TechRequired = unlockParts
	cost = 150
	entryCost = 1
	category = FuelTank
	subcategory = 0
	title = Starship Lunar Fuel Tank & Landing Legs
	manufacturer = SpaceX
	description = Starship Lunar Fuel Tank With Engine Cluster & Landing Legs.
	tags = Spacex, Starship, Lunar, Artemis, Legs
	bulkheadProfiles = size3

	//	============================================================================
	//	Thermo, Durability
	//	============================================================================

	mass = 50.125
	dragModelType = default
	breakingForce = 250
	breakingTorque = 250
	maximum_drag = 0.20
	minimum_drag = 0.15
	angularDrag = 2
	crashTolerance = 20
	maxTemp = 973.15
	skinMaxTemp = 1073.15
	emissiveConstant = 0.6 // not too absorptive for reentry
	thermalMassModifier = 1.0
	skinMassPerArea = 2.0
	radiatorHeadroom = 0.5

	//	============================================================================
	//	Animations and Textures
	//	============================================================================

	EFFECTS
	{
		running1
		{
			AUDIO_MULTI_POOL
			{
				channel = Ship
				transformName = rcsThrust
				clip = sound_rocket_mini
				volume = 0.0 0.0
				volume = 0.02 0.1
				volume = 0.5 0.1
				volume = 1.0 0.1
				pitch = 0.0 0.75
				pitch = 1.0 1.5
				loop = true
			}
			MODEL_MULTI_PARTICLE
			{
				modelName = Squad/FX/Monoprop_small
				transformName = rcsThrust
				emission = 0.0 0.0
				emission = 0.1 0.0
				emission = 1.0 1.0
				speed = 0.0 0.8
				speed = 1.0 1.0
				localRotation = -90, 0, 0
			}
		}
	}

	//	============================================================================
	//	Modules and Resources
	//	============================================================================

	MODULE
	{
		name = AdjustableCoMShifter
		DescentModeCoM = 0.0, -10.0, 0.0
	}

	MODULE
	{
		name = ModuleEnginesRF
		thrustVectorTransformName = thrustTransform
		EngineType = LiquidFuel
		throttleResponseRate = 10
	}

	MODULE
	{
		name = FXModuleAnimateThrottle
		animationName = FIRE
		responseSpeed = 0.02
		dependOnEngineState = True
		dependOnThrottle = True
	}

	MODULE
	{
		name = ModuleGimbal
		gimbalTransformName = thrustTransform
		gimbalRange = 6.0
		gimbalResponseSpeed = 16
		useGimbalResponseSpeed = true
	}

	MODULE
	{
		name = ModuleSurfaceFX
		thrustProviderModuleIndex = 0
		fxMax = 0.5
		maxDistance = 30
		falloff = 1.7
		thrustTransformName = thrustTransform
	}

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		modded = false
		configuration = StarshipLunar
		CONFIG
		{
			name = StarshipLunar
			minThrust = 800.0
			maxThrust = 2000.0
			heatProduction = 160
			PROPELLANT
			{
				name = LqdMethane
				ratio = 0.43
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.57
			}
			atmosphereCurve
			{
				key = 0 340
				key = 1 200
			}

			ullage = True
			pressureFed = False
			ignitions = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 1.0
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines
			{
				name = LqdMethane
				amount = 0.43
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines
			{
				name = LqdOxygen
				amount = 0.57
			}
		}
	}

	MODULE
	{
		name = ModuleRCSFX
		stagingEnabled = True
		thrusterTransformName = rcsThrust
		thrusterPower = 30
		resourceFlowMode = STAGE_PRIORITY_FLOW
		runningEffectName = running1
		showToggles = False
		PROPELLANT
		{
			name = LqdMethane
			ratio = 0.43
		}
		PROPELLANT
		{
			name = LqdOxygen
			ratio = 0.57
		}
		atmosphereCurve
		{
			key = 0 330
			key = 1 240
		}
	}

	MODULE
	{
		name = ModuleFuelTanks
		volume = 1440230
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = Full
			maxAmount = 43.0%
		}
		TANK
		{
			name = LqdOxygen
			amount = Full
			maxAmount = 57.0%
		}
	}

	MODULE
	{
		name = ModuleActiveRadiator
		maxEnergyTransfer = 50000
		overcoolFactor = 0.0186367
		isCoreRadiator = true
		RESOURCE
		{
			name = ElectricCharge
			rate = 0.500
		}		
	}

	//	============================================================================
	//	Starship Lunar Landing Legs (SSPX HabUtils)
	//	============================================================================

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegA
		BaseTransformName = LegBaseTransform001
		FootTransformName = LegFootTransform001
		LegID = LegA
		ExtenderTransformName = Leg001
		LegExtension = 0
		ExtenderMin = 0.02
		ExtenderMax = 1.185
		ExtensionRate = 4.0
		PhysicsBounce = 0.0
		PhysicsStaticFriction = 1.2
		PhysicsDynamicFriction = 1.0
		FeetPointOutwards = true
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegB
		BaseTransformName =	LegBaseTransform002
		FootTransformName = LegFootTransform002
		LegID = LegB
		ExtenderTransformName = Leg002
		LegExtension = 0
		ExtenderMin = 0.02
		ExtenderMax = 1.185
		ExtensionRate = 4.0
		PhysicsBounce = 0.0
		PhysicsStaticFriction = 1.2
		PhysicsDynamicFriction = 1.0
		FeetPointOutwards = true
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegC
		BaseTransformName =	LegBaseTransform003
		FootTransformName = LegFootTransform003
		LegID = LegC
		ExtenderTransformName = Leg003
		LegExtension = 0
		ExtenderMin = 0.02
		ExtenderMax = 1.185
		ExtensionRate = 4.0
		PhysicsBounce = 0.0
		PhysicsStaticFriction = 1.2
		PhysicsDynamicFriction = 1.0
		FeetPointOutwards = true
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegD
		BaseTransformName =	LegBaseTransform004
		FootTransformName = LegFootTransform004
		LegID = LegD
		ExtenderTransformName = Leg004
		LegExtension = 0
		ExtenderMin = 0.02
		ExtenderMax = 1.185
		ExtensionRate = 4.0
		PhysicsBounce = 0.0
		PhysicsStaticFriction = 1.2
		PhysicsDynamicFriction = 1.0
		FeetPointOutwards = true
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegE
		BaseTransformName =	LegBaseTransform005
		FootTransformName = LegFootTransform005
		LegID = LegE
		ExtenderTransformName = Leg005
		LegExtension = 0
		ExtenderMin = 0.02
		ExtenderMax = 1.185
		ExtensionRate = 4.0
		PhysicsBounce = 0.0
		PhysicsStaticFriction = 1.2
		PhysicsDynamicFriction = 1.0
		FeetPointOutwards = true
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegF
		BaseTransformName =	LegBaseTransform006
		FootTransformName = LegFootTransform006
		LegID = LegF
		ExtenderTransformName = Leg006
		LegExtension = 0
		ExtenderMin = 0.02
		ExtenderMax = 1.185
		ExtensionRate = 4.0
		PhysicsBounce = 0.0
		PhysicsStaticFriction = 1.2
		PhysicsDynamicFriction = 1.0
		FeetPointOutwards = true
	}

	MODULE
	{
		name = ModuleLevelingBase
		Automated = false
		LevelingTransformName = LevelingTransform
		LinkedExtensionMax = 1.185
		MinimumAutoLevelFraction = 30
	}
}

@PART[ROC-StarshipLunarTank]:HAS[@MODULE[ModuleEngineConfigs]:HAS[@CONFIG[StarshipLunar]],!MODULE[TestFlightInterop]]:BEFORE[zTestFlight]
{
	TESTFLIGHT
	{
		name = StarshipLunar
		ratedBurnTime = 2400 //Guess
		ignitionReliabilityStart = 0.98 //Slight Chance of the Torch-lit system failing
		ignitionReliabilityEnd = 0.995 //Slight Chance of the Torch-lit system failing
		cycleReliabilityStart = 0.99975
		cycleReliabilityEnd = 0.99995
	}
}

//	============================================================================
//	Starship Lunar Engine Cluster (vacuum variant) plume setup.
//	============================================================================

@PART[ROC-StarshipLunarTank]:BEFORE[RealPlume]
{
	PLUME
	{
		name = Methalox_Upper
		transformName = thrustTransform
		localRotation = 0,0,0
		localPosition = 0,0.0,-0.75
		fixedScale = 0.25
		energy = 1
		speed = 1
		emissionMult = 0.5
		alphaMult = 1

		flarePosition = 0,0,0.15
		flareScale = 0.75

		plumePosition = 0,0,0.5
		plumeScale = 1.5

		fumePosition = 0,0,2.5
		fumeScale = 1.5

		shockPosition = 0,0,2.5
		shockScale = 0.5
	}

	@MODULE[ModuleEngines*]
	{
		%powerEffectName = Methalox_Upper
		!runningEffectName = DELETE
	}

	@MODULE[ModuleEngineConfigs]
	{
		@CONFIG,*
		{
			%powerEffectName = Methalox_Upper
		}
	}
}

@TANK_DEFINITION[Tank-Sep-Starship|Tank-Sep-Starship-HP]:FOR[zzzRealismOverhaul]
{
	@TANK[LqdMethane]
	{
		@wallConduction = 22
		%isDewar = True
	}
	@TANK[LqdOxygen]
	{
		@wallConduction = 22
		%isDewar = True
	}
}
