PART
{
	name = ROC-StarshipLunarTank
	module = Part
	author = Stanley Creative, Vader111

	RSSROConfig = True

	//	============================================================================
	//	Model and Dimensions
	//	============================================================================

	MODEL
	{
		model = ROCapsules/Assets/Vader111/Starship/StarshipLunarTank
	}

	scale = 1.0
	rescaleFactor = 1.0

	node_stack_top = 0.0, 11.3839, 0.0, 0.0, 1.0, 0.0, 3
	node_stack_bottom = 0.0, -20.8054, 0.0, 0.0, -1.0, 0.0, 3

	node_stack_RaptorSrf1 = 0.82251, -17.5, 0.474137 , 0.0, -1.0, 0.0, 2
	node_stack_RaptorSrf2 = -0.82251, -17.5, 0.474137, 0.0, -1.0, 0.0, 2
	node_stack_RaptorSrf3 = 0.0, -17.5, -0.948548, 0.0, -1.0, 0.0, 2

	node_stack_RaptorVac1 = -2.6145, -16.25, -1.50787, 0.0, -1.0, 0.0, 2
	node_stack_RaptorVac2 = 2.6145, -16.25, -1.50787, 0.0, -1.0, 0.0, 2
	node_stack_RaptorVac3 = 0.0, -16.25, 3.02008, 0.0, -1.0, 0.0, 2

	CoPOffset = 0.0, -8.0, 0.0
	CoMOffset = 0.0, -10.0, 0.0
	CoLOffset = 0.0, -12.0, 0.0

	attachRules = 1,0,1,0,0

	//	============================================================================
	//	Title, Description, Category, Techs
	//	============================================================================

	TechRequired = unlockParts
	cost = 150
	entryCost = 1
	category = FuelTank
	subcategory = 0
	title = Starship Lunar Fuel Tank & Legs
	manufacturer = SpaceX
	description = Starship Lunar Fuel Tank With Engine Clusters & Landing Legs.
	tags = Spacex, Starship, Lunar, Artemis, Legs
	bulkheadProfiles = size3

	//	============================================================================
	//	Thermo, Durability
	//	============================================================================

	mass = 30
	dragModelType = default
	breakingForce = 250
	breakingTorque = 250
	maximum_drag = 0.20
	minimum_drag = 0.15
	angularDrag = 2
	crashTolerance = 12
	maxTemp = 973.15
	skinMaxTemp = 1073.15
	emissiveConstant = 0.6 // not too absorptive for reentry
	thermalMassModifier = 1.0
	skinMassPerArea = 2.0
	radiatorHeadroom = 0.5

	//	============================================================================
	//	Animations and Textures
	//	============================================================================

	EFFECTS
	{
		running1
		{
			AUDIO_MULTI_POOL
			{
				channel = Ship
				transformName = rcsThrust
				clip = sound_rocket_mini
				volume = 0.0 0.0
				volume = 0.02 0.1
				volume = 0.5 0.1
				volume = 1.0 0.1
				pitch = 0.0 0.75
				pitch = 1.0 1.5
				loop = true
			}
			MODEL_MULTI_PARTICLE
			{
				modelName = Squad/FX/Monoprop_small
				transformName = rcsThrust
				emission = 0.0 0.0
				emission = 0.1 0.0
				emission = 1.0 1.0
				speed = 0.0 0.8
				speed = 1.0 1.0
				localRotation = -90, 0, 0
			}
		}
		deploy
		{
			AUDIO
			{
				channel = Ship
				clip = Squad/Sounds/elev_start
				volume = 0 0
				volume = 1 0.5
				pitch = 0.5
			}
			AUDIO_LOOP
			{
				channel = Ship
				clip = Squad/Sounds/elev_loop
				volume = 0 0
				volume = 1 0.5
				pitch = 0.5
			}
		}
		deployed
		{
			AUDIO
			{
				channel = Ship
				clip = Squad/Sounds/elev_stop
				volume = 0 0
				volume = 1 0.5
				pitch = 0.5
			}
		}
		retract
		{
			AUDIO
			{
				channel = Ship
				clip = Squad/Sounds/elev_start
				volume = 0 0
				volume = 1 0.5
				pitch = 0.5
			}
			AUDIO_LOOP
			{
				channel = Ship
				clip = Squad/Sounds/elev_loop
				volume = 0 0
				volume = 1 0.5
				pitch = 0.6
			}
		}
		retracted
		{
			AUDIO
			{
				channel = Ship
				clip = Squad/Sounds/elev_stop
				volume = 0 0
				volume = 1 0.5
				pitch = 0.75
			}
		}
	}

	//	============================================================================
	//	Modules and Resources
	//	============================================================================

	MODULE
	{
		name = ModuleReactionWheel
		PitchTorque = 65
		YawTorque = 65
		RollTorque = 65
		RESOURCE
		{
			name = ElectricCharge
			rate = 0.250
		}
	}

	MODULE
	{
		name = ModuleEnginesRF
		thrustVectorTransformName = thrustTransform
		EngineType = LiquidFuel
	}

	MODULE
	{
		name = FXModuleAnimateThrottle
		animationName = FIRE
		responseSpeed = 0.02
		dependOnEngineState = True
		dependOnThrottle = True
	}

	MODULE
	{
		name = ModuleGimbal
		gimbalTransformName = thrustTransform
		gimbalRange = 5.0
		gimbalResponseSpeed = 15
		useGimbalResponseSpeed = true
	}

	MODULE
	{
		name = ModuleSurfaceFX
		thrustProviderModuleIndex = 0
		fxMax = 0.5
		maxDistance = 30
		falloff = 1.7
		thrustTransformName = thrustTransform
	}

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = Starship Lunar Engines

		CONFIG
		{
			name = Starship Lunar Engines
			minThrust = 1345.14
			maxThrust = 3362.85
			heatProduction = 100

			PROPELLANT
			{
				name = LqdMethane
				ratio = 0.4320
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.5680
			}
			atmosphereCurve
			{
				key = 0 380
				key = 1 280
			}

			ullage = True
			pressureFed = False
			ignitions = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 0.5
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines
			{
				name = LqdMethane
				amount = 0.05
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines
			{
				name = LqdOxygen
				amount = 0.33
			}
		}
	}

	MODULE
	{
		name = ModuleRCSFX
		stagingEnabled = False
		thrusterTransformName = rcsThrust
		thrusterPower = 20.26
		resourceFlowMode = STAGE_PRIORITY_FLOW
		runningEffectName = running1
		rcsEnabled = True
		PROPELLANT
		{
			name = LqdMethane
			ratio = 0.05
		}
		PROPELLANT
		{
			name = LqdOxygen
			ratio = 0.33
		}
		atmosphereCurve
		{
			key = 0 310
			key = 1 174
		}
	}

	MODULE
	{
		name = ModuleFuelTanks
		volume = 1576074
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = 677712
			maxAmount = 677712
			isTweakable = False
			isDewar = True
		}
		TANK
		{
			name = LqdOxygen
			amount = 898362
			maxAmount = 898362
			isTweakable = False
			isDewar = True
		}
	}

	//	============================================================================
	//	Starship Lunar Landing Legs (SSPX HabUtils)
	//	============================================================================

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegA
		BaseTransformName =	 LegBaseTransform001
		FootTransformName = LegFootTransform001
		LegID = LegA
		ExtenderTransformName = Leg001
		LegExtension = 0
		ExtenderMin = 0.0
		ExtenderMax = 1.18888
		ExtensionRate = 0.8
		PhysicsStaticFriction = 0.9
		PhysicsDynamicFriction = 0.9
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName =LegB
		BaseTransformName =	 LegBaseTransform002
		FootTransformName = LegFootTransform002
		LegID = LegB
		ExtenderTransformName = Leg002
		LegExtension = 0
		ExtenderMin = 0.0
		ExtenderMax = 1.18888
		ExtensionRate = 0.8
		PhysicsStaticFriction = 0.9
		PhysicsDynamicFriction = 0.9
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegC
		BaseTransformName =	 LegBaseTransform003
		FootTransformName = LegFootTransform003
		LegID = LegC
		ExtenderTransformName = Leg003
		LegExtension = 0
		ExtenderMin = 0.0
		ExtenderMax = 1.18888
		ExtensionRate = 0.8
		PhysicsStaticFriction = 0.9
		PhysicsDynamicFriction = 0.9
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegD
		BaseTransformName =	 LegBaseTransform004
		FootTransformName = LegFootTransform004
		LegID = LegD
		ExtenderTransformName = Leg004
		LegExtension = 0
		ExtenderMin = 0.0
		ExtenderMax = 1.18888
		ExtensionRate = 0.8
		PhysicsStaticFriction = 0.9
		PhysicsDynamicFriction = 0.9
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegE
		BaseTransformName =	 LegBaseTransform005
		FootTransformName = LegFootTransform005
		LegID = LegE
		ExtenderTransformName = Leg005
		LegExtension = 0
		ExtenderMin = 0.0
		ExtenderMax = 1.18888
		ExtensionRate = 0.8
		PhysicsStaticFriction = 0.9
		PhysicsDynamicFriction = 0.9
	}

	MODULE
	{
		name = ModuleAdjustableLeg
		LegDisplayName = LegF
		BaseTransformName =	 LegBaseTransform006
		FootTransformName = LegFootTransform006
		LegID = LegF
		ExtenderTransformName = Leg006
		LegExtension = 0
		ExtenderMin = 0.0
		ExtenderMax = 1.18888
		ExtensionRate = 0.8
		PhysicsStaticFriction = 0.9
		PhysicsDynamicFriction = 0.9
	}

	MODULE
	{
		name = ModuleLevelingBase
		Automated = true
		LevelingTransformName = LevelingTransform
		LinkedExtensionMax = 1.18888
	}
}

@PART[ROC-StarshipLunarTank]:HAS[@MODULE[ModuleEngineConfigs]:HAS[@CONFIG[Starship?Lunar?Engines]],!MODULE[TestFlightInterop]]:BEFORE[zTestFlight]

{
	TESTFLIGHT
	{
		name = Starship Lunar Engines
		ratedBurnTime = 3600 //Guess
		ignitionReliabilityStart = 0.98 //Slight Chance of the Torch-lit system failing
		ignitionReliabilityEnd = 0.995 //Slight Chance of the Torch-lit system failing
		cycleReliabilityStart = 0.99975
		cycleReliabilityEnd = 0.99995
	}
}

//	==================================================
//	Starship Lunar Engine Cluster (vacuum variant) plume setup.
//	==================================================

@PART[ROC-StarshipLunarTank]:FOR[RealPlume]:NEEDS[SmokeScreen]
{
	PLUME
	{
		name = Methalox_Upper
		transformName = thrustTransform
		localRotation = 0,0,0
		localPosition = 0,0.0,-0.75
		fixedScale = 0.5
		energy = 1
		speed = 1
		emissionMult = 0.5
		alphaMult = 1

		flarePosition = 0,0,0.23
		flareScale = 0.65

		plumePosition = 0,0,1.2
		plumeScale = 4

		fumePosition = 0,0,3.5
		fumeScale = 4.2

		shockPosition = 0,0,3
		shockScale = 1.06
	}

	@MODULE[ModuleEngines*]
	{
		%powerEffectName = Methalox_Upper
		!runningEffectName = DELETE
	}

	@MODULE[ModuleEngineConfigs]
	{
		@CONFIG,*
		{
			%powerEffectName = Methalox_Upper
		}
	}
}
