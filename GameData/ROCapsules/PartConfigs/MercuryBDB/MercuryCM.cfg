PART
{
	name = ROC-MercuryCMBDB
	module = Part
	author = CobaltWolf, capkirk

	RSSROConfig = true

	//	================================================================================
	//Source for all Mercury Masses: http://www.alternatewars.com/BBOW/Space/JSC-26098_Design_Mass_Properties_II.pdf
	//	================================================================================
	//Mercury Reentry Module dry mass breakdown:
	//	================================================================================
	//Airbrake: 18 lbs
	//	Other: 18 lbs
	//	================================================================================
	//CM: 1488 lbs
	//	Structure: 269 lbs
	//		Pressurized Body: 71 lbs
	//		Large Bulkhead: 47 lbs
	//		Small Bulkhead: 16 lbs
	//		Hatch: 16 lbs
	//		Windows and Frame: 30 lbs
	//		Special Rings: 35 lbs
	//		Shear Webs: 28 lbs
	//		Doors: 15 lbs
	//		Miscl: 11 lbs
	//	TPS: 126 lbs
	//		Heat Prot Shingles: 114 lbs
	//		Insulation: 12 lbs (dividing this up so HS mass agrees with autoconfig mass)
	//	Propulsion: 100 lbs
	//		RCS Controllers: 12 lbs
	//		RCS Pressurization Sys: 17 lbs
	//		RCS Propellant Sys: 43 lbs
	//		Retro Wiring: 28 lbs
	//	Power: 320 lbs
	//		Primary Batt: 152 lbs
	//		Squib Batt: 50 lbs
	//		Miscl Batt: 10 lbs
	//		DC Power Sys: 14 lbs
	//		AC Power Sys: 30 lbs
	//		Wiring: 46 lbs
	//		Miscl: 6 lbs
	//		Mounting: 12 lbs
	//	Avionics: 315 lbs
	//		Communications: 113 lbs
	//		Instrumentation: 121 lbs
	//		Attitude Contr Sys: 81 lbs
	//	Enviromental: 337 lbs
	//		Environmental Contr Sys: 123 lbs (127 lbs - 4 lbs/1.81 kg LiOH)
	//		Panels, Misc: 66 lbs
	//		Seat: 54 lbs
	//		Seat Instl: 16 lbs
	//		Manual Contr: 26 lbs
	//		Interior Lights: 4 lbs
	//		Displays: 48 lbs
	//	Other: 21 lbs
	//		Chute, Impact Sys Wir: 21 lbs
	//	================================================================================
	//HS: 531 lbs
	//	(Autoconfig tool assigns 197 lbs ablator, 157 lbs struct, for 354 lbs total)
	//	TPS: 354 lbs
	//		Insulation: 46 lbs (dividing this up so HS mass agrees with autoconfig mass)
	//		HS: 308 lbs
	//	Other: 177 lbs
	//		Impact Sys: 136 lbs
	//		Ballast: 41 lbs
	//	================================================================================
	//Nose Cap: 72 lbs
	//	Structure: 72 lbs
	//		Nose Antenna Struct: 37 lbs
	//		Antenna: 27 lbs
	//		Antenna Misc: 8 lbs
	//	================================================================================
	//RCS: 280 lbs
	//	Structure: 36 lbs
	//		Parachute Struct: 36 lbs
	//	Propulsion: 52 lbs
	//		RCS Thrusters: 21 lbs
	//		RCS Mounting: 11 lbs
	//		RCS Insulation: 10 lbs
	//		RCS Heat Sink: 10 lbs
	//	Other: 192 lbs
	//		Chutes: 157 lbs
	//		Recovery Sys: 35 lbs
	//	================================================================================
	//TOTAL DRY MASS: 2389 lbs (2393 - 4 lbs LiOH)
	//	Structure: 377 lbs
	//	TPS: 480 lbs
	//	Propulsion: 152 lbs
	//	Power: 320 lbs
	//	Avionics: 315 lbs
	//	Enviromental: 337 lbs (341 lbs - 4 lbs LiOH)
	//	Other: 408 lbs

	//	================================================================================
	//Mercury Reentry Module Inert Mass Breakdowns
	//	================================================================================
	//CM: 40 lbs (+ 204 lbs astronaut+suit)
	//	RCS Peroxide Residuals: 5 lbs
	//	Crew: 180 lbs (not incl.)
	//	Suit: 24 lbs (not incl.)
	//	Survival Kit: 34 lbs
	//	Ballast: 1 lbs
	//INERT MASS: 40 lbs

	//TOTAL INERT MASS: 2429 lbs (not incl. astronaut and 4 lbs LiOH, 2637 with)

	//	================================================================================
	//Mercury Reentry Module Wet Mass Breakdowns
	//	================================================================================
	//CM: 90.5 lbs
	//	CM Propellant: 55.5 lbs (25.17 kg)
	//		RCS Press (Helium): 0.5 lbs (0.227 kg)
	//		RCS Peroxide Usable: 55 lbs (24.95 kg)
	//	CM LS: 35 lbs (15.88 kg)
	//		Water (Cooling): 15 lbs (6.80 kg)
	//		Oxygen (Crew): 8 lbs (3.63 kg)
	//		Water (Crew): 8 lbs (3.63 kg)
	//		LiOH: 4 lbs (1.81 kg)
	//WET MASS: 90.5 lbs

	//TOTAL GROSS MASS: 2519.5 lbs (not incl. astronaut, 2723.5 lbs with)

	//	================================================================================
	//Kerbonaut weight: 220 lbs (close enough)
	//	================================================================================

	//	================================================================================
	//Ultimate Part Mass Assignments:
	//	================================================================================
	//	Airbrake: 18 lbs (8.165 kg)
	//		Dry Mass: 18 lbs
	//	================================================================================
	//	CM: 1528 lbs (693.10 kg)
	//		Dry Mass: 1492 lbs
	//		Inert Mass: 40 lbs
	//	================================================================================
	//	HS: 531 lbs (240.86 kg)
	//		Dry Mass: 531 lbs
	//	================================================================================
	//	Nose Cap: 72 lbs (32.66 kg)
	//		Dry Mass: 72 lbs
	//	================================================================================
	//	RCS: 280 lbs (127.01 kg)
	//		Dry Mass: 280 lbs
	//	================================================================================
	//INERT MASS: 2429 lbs (1101.78 kg)

	//	================================================================================
	//Ultimate Part Resource Assignments:
	//	================================================================================
	//CM:
	//	CM Propellant: 23.795 L
	//		Helium: 1265 L (/200)
	//		HTP: 17.44 L
	//	CM LS: 24.543 L
	//		Water (Cooling): 6.8 L	(This might become it's own resource one day)
	//		Water (Crew): 3.63 L
	//		Oxygen (Crew): 2574.5 L (/200)
	//		LiOH: 1.24 L
	//	CM EC: 48600 EC (1,000 EC/L)
	//		EC: 48.6 L
	//	CM Excess: 27.6 L (???)
	//TOTAL TANK SIZE (NO LS): 100.0 L
	//TOTAL TANK SIZE (W/ LS): 124.6 L

	//	================================================================================
	//Tank Mass Compensation
	//	================================================================================
	//	CM Propellant Tank (SM-II): 5.13 kg
	//	CM LS Tank (SM-II): 8.09 kg
	//	CM Batteries (SM-III): 87.48 kg

	MODEL
	{
		model = ROCapsules/Assets/BDB/Mercury/bluedog_Mercury_Capsule
		rotation = 0, 180, 0
	}

	rescaleFactor = 1.512
	scale = 1
	node_stack_top = 0.0,  0.49839, 0.0, 0.0, 1.0, 0.0, 1
	node_stack_bottom = 0.0, -0.47261, 0.0, 0.0, -1.0, 0.0, 1
	CenterOfBuoyancy = 0.0, 0.0, -0.05
	//CenterOfDisplacement = 0.0, -0.3, 0.0
	buoyancy = 1.1
	buoyancyUseSine = False
	CoPOffset = 0.0, 0.3, 0.0
	CoLOffset = 0.0, -0.3, 0.0
	CoMOffset = 0, -0.15, 0

	// --Original values
	// CenterOfBuoyancy = 0.0, 0.5, 0.0
	// CenterOfDisplacement = 0.0, -0.3, 0.0
	// buoyancy = 1.5
	// buoyancyUseSine = False
	// CoPOffset = 0.0, 0.5, 0.0
	// CoLOffset = 0.0, -0.35, 0.0
	// CoMOffset = 0, 0, 0
	// -------------

	TechRequired = engineering101
	entryCost = 1000
	cost = 1000
	category = Pods
	subcategory = 0
	title = Mercury Capsule
	manufacturer = McDonnell Aircraft
	description = The first American spacecraft. Carrying a single astronaut, it can be launched suborbital on a Redstone or into orbit on Atlas LV3B.
	attachRules = 1,0,1,1,0
	
	mass = 0.61437	//693.10 kg - 5.13 kg (propellant tanks) - 87.48 kg (batteries) + 15.88 kg (LS resources) and 2 kg for trim (something adds 2 kg that I can't track down)
	//Subtract mass of propellant tanks and battery from base mass
	//Life support mass will be subtracted when LS resources are patched
	
	dragModelType = default
	maximum_drag = 0.20
	minimum_drag = 0.15
	angularDrag = 2
	crashTolerance = 8

	//Thermal Stuff
	//Skin made of Rene 41 shingles (max temp 1144)
	//Peak temp on HS: ~2000 K
	//Peak temp on Walls: ~977 K
	//Peak temp on forward surfaces: ~600 K
	//Peak interior temp: ~315 K
	maxTemp = 773.15
	skinMaxTemp = 1144					//Rene 41 shingles (max temp 1144)
	emissiveConstant = 0.95				//Shingles coated in high emissivity ceramic paint
	heatConductivity = 1.0				//All conductivity. Leave this alone for now
	thermalMassModifier = 1.0			//Thermal mass. Leave this alone for now
	skinInternalConductionMult = 0.005	//Skin-to-int conductivity. Tiles isloated from structure with spacers, and had gold coating on inside to minimize radiation.
	skinMassPerArea = 3.38				//Rene 41 8.24 ton/m^3. 0.41 mm Rene 41, 3.38 kg/m^2?
	skinThermalMassModifier = 1.0		//Skin thermal mass. Leave this alone for now
	skinSkinConductionMult = 0.2		//Rene 41 is pretty conductive, and heat sink needed to spread heat. Individual panels well isolated though. Increase to help soak more heat from HS.

	breakingForce = 250
	breakingTorque = 250
	vesselType = Ship
	stagingIcon = COMMAND_POD
	CrewCapacity = 1
	bulkheadProfiles = size0, size1

	fuelCrossFeed = true

	tags = mercury crew pod CM

	EFFECTS
	{
		rcs
		{
			AUDIO_MULTI_POOL
			{
				channel = Ship
				transformName = rcsTransform
				clip = sound_rocket_mini
				volume = 0.0 0.0
				volume = 0.02 0.1
				volume = 0.5 0.1
				volume = 1.0 0.1
				pitch = 0.0 0.75
				pitch = 1.0 1.5
				loop = true
			}
			MODEL_MULTI_PARTICLE
			{
				modelName = Squad/FX/Monoprop_small
				transformName = rcsTransform
				emission = 0.0 0.0
				emission = 0.1 0.0
				emission = 1.0 1.0
				speed = 0.0 0.8
				speed = 1.0 1.0
				localRotation = -90, 0, 0
			}
		}
	}

	MODULE
	{
		name = ModuleRCSFX
		stagingEnabled = False
		thrusterTransformName = rcsTransform
		thrusterPower = 0.1067573
		resourceFlowMode = STAGE_PRIORITY_FLOW
		runningEffectName = rcs
		enablePitch = false
		enableYaw = false
		enableRoll = true
		enableX = false
		enableY = false
		enableZ = false
		PROPELLANT
		{
			name = HTP
			ratio = 1.0
		}
		PROPELLANT
		{
			name = Helium
			ratio = 10
			ignoreForIsp = true
		}
		atmosphereCurve
		{
			key = 0 137
			key = 1 57
			key = 4 0.001
		}
	}
	
	INTERNAL
	{
		name = Hermes_Crew_A_Interior
	}

	MODULE
	{
		name = ModuleCommand
		minimumCrew = 0
		RESOURCE
		{
			name = ElectricCharge
			rate = 0.53
		}
	}

	MODULE
	{
		name = ModuleSAS
		SASServiceLevel = 1
	}

	MODULE
	{
		name = ModuleScienceContainer
		reviewActionName = Review Stored Data
		storeActionName = Store Experiments
		storageRange = 2.0
	}

	MODULE
	{
		name = ModuleScienceContainer
		reviewActionName = Review Stored Data
		storeActionName = Store Experiments
		evaOnlyStorage = True
		storageRange = 2.0
	}

	MODULE
	{
		name = ModuleColorChanger
		shaderProperty = _EmissiveColor
		animRate = 0.8
		animState = false
		useRate = true
		toggleInEditor = true
		toggleInFlight = true
		toggleInFlight = true
		unfocusedRange = 5
		toggleName =  Toggle Lights
		eventOnName = Lights On
		eventOffName = Lights Off
		toggleAction = True
		defaultActionGroup = Light
		redCurve
		{
			key = 0 0 0 3
			key = 1 1 0 0
		}
		greenCurve
		{
			key = 0 0 0 1
			key = 1 1 1 0
		}
		blueCurve
		{
			key = 0 0 0 0
			key = 1 0.7 1.5 0
		}
		alphaCurve
		{
			key = 0 1
		}
	}

	//Actually had emergency escape hatch in nose. Leave nose node passable.
	MODULE:NEEDS[ConnectedLivingSpace]
	{
		name = ModuleConnectedLivingSpace
		passable = True
	}

	MODULE
	{
		name = ModuleFuelTanks
		type = SM-II
		volume = 100
		basemass = 0.61437

		TANK
		{
			name = ElectricCharge
			mass = 0.0018 // Override to get roughly correct mass. Giving players SM-III level batteries isn't ideal, but it's better than the massless batteries it had before.
			amount = 48600
			maxAmount = 48600
		}

		TANK
		{
			name = HTP		//55 lbs usable, 5 lbs unusable, 0.5 lbs helium pressurant
			amount = 17.44
			maxAmount = 17.44
		}

		TANK
		{
			name = Helium
			amount = 1265
			maxAmount = 1265
		}

	}

	//	============================================================================
	//	Animations and Textures
	//	============================================================================

	MODULE
	{
		name = ModuleAnimateGeneric
		animationName = deploy_periscope
		isOneShot = false
		startEventGUIName = Extend Periscope
		endEventGUIName = Retract Periscope
		actionGUIName = Toggle Periscope
		allowAnimationWhileShielded = False
	}

	MODULE
	{
		name = ModuleDataTransmitter
		antennaType = INTERNAL
		packetInterval = 1.0
		packetSize = 2
		packetResourceCost = 12.0
		requiredResource = ElectricCharge
		antennaPower = 5000
		optimumRange = 2500
		packetFloor = .1
		packetCeiling = 5
	}

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = meshSwitchWindows
		switcherDescription = Style
		switcherDescriptionPlural = Styles
		affectDragCubes = True
		affectFARVoxels = True

		SUBTYPE
		{
			name = Window
			transform = Window
		}

		SUBTYPE
		{
			name = Portholes
			transform = Portholes
		}

	}


	// MODULE
	// {
		// name = ModuleB9PartSwitch
		// moduleID = meshSwitchPaint
		// switcherDescription = Paint
		// switcherDescriptionPlural = Paints
		// affectDragCubes = True
		// affectFARVoxels = True
		// SUBTYPE
		// {
			// name = Black
			// transform = Black
		// }
		// SUBTYPE
		// {
			// name = White
			// transform = Black
			// TEXTURE
			// {
				// texture = ROCapsules/Assets/BDB/Mercury/bluedog_Mercury_AlternateTextures
				// baseTransform = Black
				// transform = Skin
			// }
		// }
		// SUBTYPE
		// {
			// name = Mixed
			// transform = Mixed
		// }
		// SUBTYPE
		// {
			// name = Boilerplate
			// transform = Orange
			// TEXTURE
			// {
				// texture = ROCapsules/Assets/BDB/Mercury/bluedog_Mercury_AlternateTextures
				// transform = Skin
			// }
		// }
	// }
}

//	================================================================================
//	Tac Life Support configs
//	================================================================================
@PART[ROC-MercuryCMBDB]:FOR[ROCapsules]:NEEDS[TacLifeSupport]
{
	@description ^= :$: Supports a crew of one for up to maximum 35 hours of active operations but it will require you to change the resources.
	@mass -= 0.02397	//Subtract 8.09 kg for LS tanks, 15.88 kg for LS resources

	@MODULE[ModuleFuelTanks]
	{
		@volume += 28.4		//Add 3.8 L for CO2 tank (does TAC even use that?)
		@basemass -= 0.02397	//Subtract 8.09 kg for LS tanks, 15.88 kg for LS resources

		TANK
		{
			name = Water
			amount = 10.43
			maxAmount = 10.43
		}

		TANK
		{
			name = Oxygen
			amount = 2574.5
			maxAmount = 2574.5
		}

		TANK
		{
			name = LithiumHydroxide
			amount = 1.24
			maxAmount = 1.24
		}

		TANK
		{
			name = WasteWater
			amount = 0
			maxAmount = 7.2
		}

		TANK
		{
			name = Waste
			amount = 0
			maxAmount = 5.7
		}

		TANK
		{
			name = CarbonDioxide
			amount = 0
			maxAmount = 380
		}
	}

	MODULE
	{
		name = TacGenericConverter
		converterName = CO2 LiOH Scrubber
		tag = Life Support
		StartActionName = Start CO2 Scrubber
		StopActionName = Stop CO2 Scrubber
		conversionRate = 1.0
		GeneratesHeat = False
		UseSpecialistBonus = False

		INPUT_RESOURCE
		{
			ResourceName = CarbonDioxide
			Ratio = 0.006216
			FlowMode = STAGE_PRIORITY_FLOW
		}

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.1
		}

		INPUT_RESOURCE
		{
			ResourceName = LithiumHydroxide
			Ratio = 0.00001189
			FlowMode = STAGE_PRIORITY_FLOW
		}

		OUTPUT_RESOURCE
		{
			ResourceName = Waste
			Ratio = 0.00003932
			DumpExcess = False
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
}

//	================================================================================
//	Override RO global settings to get our temperatures back
//	================================================================================
@PART[ROC-MercuryCMBDB]:AFTER[RealismOverhaul]
{
	@skinMaxTemp = 1144
}

//	================================================================================
//	Final Pass to Make Sure TAC does not add extra resources
//	================================================================================
@PART[ROC-MercuryCMBDB]:BEFORE[zzzRealismOverhaul]
{
	!RESOURCE:HAS[~name[Ablator],~name[CharredAblator]],*{}
}

//	================================================================================
//	Offset RA antenna mass
//	================================================================================
@PART[ROC-MercuryCMBDB]:AFTER[RealAntennas]
{
	@mass -= 0.0203	//Subtract 20.3 kg for a 20 dbm TL 3 antenna
	
	@MODULE[ModuleFuelTanks]
	{
		@basemass -= 0.0203
	}
}
