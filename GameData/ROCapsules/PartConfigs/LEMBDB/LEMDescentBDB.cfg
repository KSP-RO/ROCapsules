PART
{
	name = ROC-LEMDescentBDB
	module = Part
	author = CobaltWolf, capkirk123

	RSSROConfig = true

	//	================================================================================
	//Source for all Apollo Masses: http://www.alternatewars.com/BBOW/Space/JSC-26098_Design_Mass_Properties_II.pdf
	//	26 July 1971 - Apollo 15. 1st J-class Mission
	//	================================================================================
	//Apollo Lunar Descent Module Dry Mass Breakdowns:
	//	================================================================================
	//LEM Legs: 500.0 lbs
	//	Structure: 8.6 lbs
	//		Fwd Egress Platform: 8.6 lbs
	//	TPS: 5.0 lbs
	//		Upper Jsf: 0.4 lbs
	//		Side Jsf: 3.6 lbs
	//		Lower Jsf: 1.0 lbs
	//	Other: 486.4 lbs
	//		Inner Cyl Assys: 97.4 lbs
	//		Outer Cyl Assys 88.7 lbs
	//		Cartridge Assys: 24.5 lbs
	//		JSF Primary Strut: 4.8 lbs
	//		Inner Cyl Assys: 15.2 lbs
	//		Outer Cyl Assys: 14.5 lbs
	//		Cartridge Assys: 37.6 lbs
	//		Honeycomb Panel As: 40.0 lbs
	//		Bumper Assembly: 1.2 lbs
	//		Hub Assembly: 5.0 lbs
	//		JSF Landing Pad Assy: 0.7 lbs
	//		Cross Member Tube Assy: 27.1 lbs
	//		Side Brace Tube Assy: 41.0 lbs
	//		Misc Deploy Comps: 8.4 lbs
	//		JSF Deploy Truss Assy: 5.9 lbs
	//		Deployment Spring: 3.2 lbs
	//		Lock Spring Assy: 1.4 lbs
	//		Down Lock Latch Assy: 2.8 lbs
	//		Crank Cam Idler: 2.1 lbs
	//		Surface Probe Mech: 7.2 lbs
	//		JSF Mechanisms: 0.2 lbs
	//		Thermal Insul Land Gear: 46.3 lbs
	//		Egress Ladder: 6.7 lbs
	//		JSF Egress Ladder: 0.4 lbs
	//		JSF Install Primary Strut: 1.5 lbs
	//		JSF Install Secondary Strut: 0.3 lbs
	//		JSF Install Landing Pad: 1.8 lbs
	//		JSF Deploy Truss: 0.3 lbs
	//		JSF LG Install: 0.2 lbs
	//	================================================================================
	//LEM MESA: 190.1 lbs
	//	Structure: 23.2 lbs
	//		MESS Stow & Rel Stru: 23.2 lbs
	//	Environment: 166.9 lbs
	//		MESA Module: 166.9 lbs
	//	================================================================================
	//LMDE: 368.7 lbs
	//	Propulsion: 368.7 lbs
	//		Engine & Misc: 368.7 lbs
	//	================================================================================
	//LEM Descent Module: 3317.2 lbs
	//	Structure: 983.0 lbs
	//			Forward Section: 210.9 lbs
	//		Web Fwd End Closure: 6.0 lbs
	//		Upper Cap Fwd Closure: 1.2 lbs
	//		Lower Cap Fwd Closure: 1.7 lbs
	//		Post-Left Fwd Closure: 6.5 lbs
	//		Post-Right Fwd Closure: 6.5 lbs
	//		Stiffeners Fwd Closure: 5.1 lbs
	//		LG Fittings Fwd Closure: 2.0 lbs
	//		JSF Fwd Closure: 3.1 lbs
	//		Forward Left-Panel: 20.4 lbs
	//		Forward Right-Panel: 23.2 lbs
	//		Forward Upper Deck: 16.0 lbs
	//		Forward Lower Deck: 11.8 lbs
	//		Fwd Equipment Bay Left: 11.8 lbs
	//		Fwd Equipment Bay Right: 10.1 lbs
	//		Fwd Interstage Mount: 4.5 lbs
	//		Fwd Interstage Mt Col: 2.9 lbs
	//		Fwd LG Suppt Truss: 15.3 lbs
	//		Fwd Oxid Tank Support: 33.0 lbs
	//		Fwd Truss & Supports: 20.8 lbs
	//		S-IV-B Attach Ftg: 7.7 lbs
	//		Equipment Suppt Fwd Section: 1.3 lbs
	//			Center Section Left: 153.4 lbs
	//		Web Center Lft Clo: 5.4 lbs
	//		Upr Cap Cen-Left Closure: 1.1 lbs
	//		Lwr Cap Cen-Left Closure: 1.7 lbs
	//		Post Aft Left Closure: 6.5 lbs
	//		Post Fwd Left Closure: 6.7 lbs
	//		Stif Center-Left Closure: 4.2 lbs
	//		LG Ftg Center-Left Closure: 2.2 lbs
	//		JSF Center-Left Closure: 2.4 lbs
	//		Fwd Pan Center-Left: 18.5 lbs
	//		Aft Pan Center-Left: 22.5 lbs
	//		Upr Deck Center-Left: 16.5 lbs
	//		Lwr Deck Center-Left: 11.3 lbs
	//		Truss & Suppt Center-Left: 46.7 lbs
	//		S-IV-B Attach Ftg: 7.7 lbs
	//			Mid-Center Section: 112.0 lbs
	//		LF Pan Mid-Center: 14.1 lbs
	//		RT Pan Mid-Center: 14.0 lbs
	//		Fwd Pan Mid-Center: 14.8 lbs
	//		Aft Pan Mid-Center: 13.9 lbs
	//		Eng Act Suppt M-C-S: 6.2 lbs
	//		Eng Trus Supt Col: 7.9 lbs
	//		Eng Suppt Trusses: 10.6 lbs
	//		Blast Deflectors: 8.5 lbs
	//		JSF Cruciforms Etc: 4.9 lbs
	//		Equipment Support Center-Mid: 17.1 lbs
	//			Center Section Right: 167.3 lbs
	//		Web Center-Rt Closure: 5.8 lbs
	//		Upper Cap Center-Rt Closure: 1.1 lbs
	//		Lwr Cap Center-Rt Closure: 1.7 lbs
	//		Post Fwd Rt Closure: 6.6 lbs
	//		Post Aft Rt Closure: 6.5 lbs
	//		Stif Center-Rt Closure: 5.0 lbs
	//		LG Ftg Center-Rt Closure: 2.0 lbs
	//		End Closure Center-Rt: 4.4 lbs
	//		Fwd Pan Center-Rt: 21.5 lbs
	//		Aft Pan Center-Rt: 20.1 lbs
	//		Upper Deck Center-Rt: 16.1 lbs
	//		Lower Deck Center-Rt: 12.1 lbs
	//		Truss & Support Center-Rt: 51.5 lbs
	//		S-IV-B Attach Ftg: 7.6 lbs
	//		Cold Plate & Rails: 0.5 lbs
	//		Equipment Supprt Center-Rt: 4.8 lbs
	//			Aft Section: 298.1 lbs
	//		Web Aft End Closure: 6.6 lbs
	//		Upper Cap Aft Closure: 1.2 lbs
	//		Lower Cap Aft Closure: 1.7 lbs
	//		Post Left Aft Closure: 7.0 lbs
	//		Post Right Aft Closure: 7.1 lbs
	//		Stiffeners Aft Closure: 2.7 lbs
	//		LG Ftg Aft Closure: 2.0 lbs
	//		JSF Aft End Closure: 4.6 lbs
	//		Aft Left Panel: 21.2 lbs
	//		Aft Right Panel: 19.9 lbs
	//		Aft Upper Deck: 15.1 lbs
	//		Aft Lower Deck: 11.8 lbs
	//		Science Equip Bay Lower Deck: 19.7 lbs
	//		Science Equip Bay Upper Deck: 7.9 lbs
	//		Science Equip Bay Diag Cap: 11.5 lbs
	//		Science Equip Bay Rt Closure: 1.8 lbs
	//		Science Equip Bay Cen-Pan: 2.1 lbs
	//		Science Equip Bay Lt Closure: 1.8 lbs
	//		Science Equip Bay Inb-Pan: 3.3 lbs
	//		Equip Bay Right: 38.8 lbs
	//		Aft LG Support Truss: 15.2 lbs
	//		Aft Oxid Tank Support: 33.0 lbs
	//		Misc Tank Supports: 19.5 lbs
	//		Aft Truss & Suppts: 1.0 lbs
	//		S-IV-B Attach Ftg: 7.6 lbs
	//		Equipment Suppt Aft Section: 34.0 lbs
	//			Misc: 41.3 lbs
	//		Landing Gear Chocks: 3.2 lbs
	//		Miscellaneous: 5.4 lbs
	//		ALSEP Remote Deploy: 31.4 lbs
	//		Descent Structure: 1.3 lbs
	//	TPS: 457.7 lbs
	//		Thermal Protect Aft: 1.3 lbs
	//		Base Heat Shield: 0.6 lbs
	//		Upper Shielding: 56.4 lbs
	//		Upper Insulation: 27.6 lbs
	//		Upper Supports: 4.4 lbs
	//		Side Shielding: 25.9 lbs
	//		Side Insulation: 88.1 lbs
	//		Side Supports: 4.9 lbs
	//		Lower Shielding: 17.3 lbs
	//		Lower Insulation: 30.4 lbs
	//		Lower Supports: 4.7 lbs
	//		RBHS Shielding: 30.9 lbs
	//		RBHS Insulation: 66.3 lbs
	//		RBHS Jsf: 6.8 lbs
	//		RBHS Supports: 60.1 lbs
	//		Outrig Shielding: 11.6 lbs
	//		Outrig Insulation: 9.8 lbs
	//		Thermal Protection: 10.6 lbs
	//	Propulsion: 722.3 lbs
	//		Prop Tank Instal: 488.8 lbs
	//		Prop FD Disconnect Instal: 5.7 lbs
	//		Propellant Plumbing: 45.8 lbs
	//		Helium Tank: 113.9 lbs
	//		Pressurization Plumbing: 68.1 lbs
	//	Power: 786.4 lbs
	//		Battery Descent: 670.3 lbs
	//		Elect Control Assy: 39.5 lbs
	//		Electronic Unit: 3.2 lbs
	//		GN&C Harness Assy: 2.3 lbs
	//		ECS Harness Assy: 0.1 lbs
	//		Instr Harness Assy: 0.7 lbs
	//		EPS Harness Assy: 1.6 lbs
	//		Prop Harness Assy: 4.6 lbs
	//		EDS Harness Assy: 6.9 lbs
	//		Multi-Subsys Harness: 31.3 lbs
	//		EPS Instal Hardware: 12.3 lbs
	//		Delta Weight Changes: 5.0 lbs
	//		EPS Descent Stage: 8.6 lbs
	//	Avionics: 63.0 lbs
	//		DECA: 13.1 lbs
	//		Land Radar Sect: 43.2 lbs
	//		ECS Sensors: 1.8 lbs
	//		Prop Sensors: 2.7 lbs
	//		Mech Des Sensor: 1.9 lbs
	//		Instrumentation Sensors: 0.3 lbs
	//	Environment: 189.8 lbs
	//		Displays & Controls: 3.3 lbs
	//		Descent Crew Provisions: 61.1 lbs (not incl., move to wet mass)
	//		Inert Descent Stage LM: 92.7 lbs
	//		O2 System: 60.0 lbs
	//		H2O System: 22.6 lbs
	//		Glycol System: 3.0 lbs
	//		PLSS O2 recharge: 8.2 lbs
	//		LiOH Cartridges: 9.1 lbs (not incl., move to wet mass)
	//	Other: 115.0 lbs
	//		Descent Explosive Device: 14.2 lbs
	//		Descent Structure: 10.4 lbs
	//		PLSS Batteries: 33.6 lbs
	//		BPS Installed Hardware: 2.3 lbs
	//		Crew Provisions: 78.9 lbs
	//		Various Updates: -14.8 lbs
	//		Mfg Variation At Whg: -9.6 lbs
	//	================================================================================
	//TOTAL DRY MASS: 4376.0 lbs
	//	Structure: 1014.8 lbs
	//	TPS: 462.7 lbs
	//	Propulsion: 1091.0 lbs
	//	Power: 786.4 lbs
	//	Avionics: 63.0 lbs
	//	Environment: 356.7 lbs
	//	Other: 601.4 lbs

	//	================================================================================
	//Apollo Lunar Descent Module Inert Mass Breakdowns:
	//	================================================================================
	//LEM Descent Module: 1.4 lbs
	//	Non-Cargo: 1.4 lbs
	//		Unused DPS Prop: 348.9 lbs (not incl., move to wet mass)
	//		Trapped DPS Prop: 76.3 lbs (not incl., move to wet mass)
	//		Disp & Malfunction Prop: 337.7 lbs (not incl., move to wet mass)
	//		Residual Water: 0.4 lbs
	//		Nitrogen DSC H20 Tank: 1.0 lbs
	//	Cargo: 0 lbs
	//		Science Equip: 1099.1 lbs (not incl.)
	//INERT MASS: 1.4 lbs

	//TOTAL INERT MASS: 4377.4 lbs

	//	================================================================================
	//Apollo Lunar Descent Module Wet Mass Breakdowns:
	//	================================================================================
	//LEM Descent Module: 20188.3 lbs
	//	Non-Propellant: 574.6 lbs
	//		Coolant: 2.6 lbs
	//		GOX: 93.8 lbs
	//		Tanked Water: 408.0 lbs
	//		LiOH Cartridges: 9.1 lbs
	//		Descent Crew Provisions: 61.1 lbs
	//	Propellant: 19613.7 lbs
	//		Main Delta-V Prop: 18798.6 lbs
	//		+Unused DPS Prop: 348.9 lbs
	//		+Trapped DPS Prop: 76.3 lbs
	//		+Disp & Malfunction Prop: 337.7 lbs
	//		Helium DPS: 52.2 lbs

	//GROSS MASS: 24565.7 lbs
	//ALL INCLUDED GROSS MASS: 25664.8 lbs

	//	================================================================================
	//Ultimate Part Mass Assignments:
	//	================================================================================
	//	LEM Legs: 125.0 lbs (56.70 kg) (x4)
	//		Dry Mass: 125.0 lbs
	//	================================================================================
	//	LEM MESA: 190.1 lbs (86.23 kg)
	//		Dry Mass: 190.1 lbs
	//	================================================================================
	//	LMDE: 368.7 lbs (167.24 kg)
	//		Dry Mass: 368.7 lbs
	//	================================================================================
	//	LEM Descent Module: 3318.6 lbs (1505.29 kg)
	//		Dry Mass: 3317.2 lbs
	//		Inert Mass: 1.4 lbs
	//	================================================================================
	//INERT MASS: 4377.4 lbs (1985.55 kg)

	//	================================================================================
	//Ultimate Part Resource Assignments:
	//	================================================================================
	//LM Descent Module:
	//	DPS Propellant: 8220.18 L
	//		AZ50: 3791.5 L
	//		NTO: 3765.8 L
	//		Helium: 132575 L (/200)
	//	LM Descent LS: 132.85 L
	//		Water (Cooling): 1.18 L
	//		Water (Crew): 185.07 L
	//		Oxygen: 30177 L (/200)
	//		LiOH: 2.83 L
	//	LM Ascent EC: 201600 EC (1,000 EC/L)
	//		EC: 201.6 L
	//	LM Excess: 1000 L (???)
	//	LS Resources Mass: 232.92 kg
	//TOTAL TANK SIZE (NO LS): 9421.78 L
	//TOTAL TANK SIZE (LS): 9554.63 L

	//	================================================================================
	//Tank Mass Compensation
	//	================================================================================
	//	LM Descent DPS Tank (SM-IV): 789.40 kg
	//	LM Descent LS Tank (SM-IV): 32.60 kg
	//	LM Descent Batteries (SM-IV): 290.3 kg

	//	============================================================================
	//	Model and Dimensions
	//	============================================================================

	MODEL
	{
		model = ROCapsules/Assets/BDB/Apollo/LM_DescentStage
		rotation = 0, 180, 0
	}

	scale = 1.0
	rescaleFactor = 1.5646

	node_stack_top = 0.0, 0.58759, 0.0, 0.0, 1.0, 0.0, 1
	node_stack_bottom = 0.0, -0.10226, 0.0, 0, -1, 0, 1
	//node_stack_bottom2 = 0.0, -0.37979, 0.0, 0, -1, 0, 1

	stackSymmetry = 3

	NODE
	{
		name = legAttach_1
		transform = legNode_1
		size = 1
		method = FIXED_JOINT
	}
	NODE
	{
		name = legAttach_2
		transform = legNode_2
		size = 1
		method = FIXED_JOINT
	}
	NODE
	{
		name = legAttach_3
		transform = legNode_3
		size = 1
		method = FIXED_JOINT
	}
	NODE
	{
		name = legAttach_4
		transform = legNode_4
		size = 1
		method = FIXED_JOINT
	}
	// stack, srfAttach, allowStack, allowSrfAttach, allowCollision
	attachRules = 1,0,1,1,0

	//	============================================================================
	//	Title, Description, Category, Techs
	//	============================================================================

	TechRequired = unlockParts
	cost = 150
	entryCost = 1
	category = FuelTank
	subcategory = 0
	title = #rocLEMDescentBDBTitle	//Apollo LM Descent Stage
	manufacturer = #roMfrGrumman
	description = #rocLEMDescentBDBDesc	//The Apollo Lunar Module descent stage. Equipped with storage boxes for storing equipment.
	tags = apollo, moon, lunar, crew, armstrong, aldrin, cm, csm, saturn, v, lem, lm, module, descent, landing, land, legs

	bulkheadProfiles = size1, size2

	//	============================================================================
	//	Thermo, Durability
	//	============================================================================

	mass = 0.69111	//1505.29 kg - 789.40 kg (DPS Tanks) - 290.3 kg (Batteries) + 32.60 kg (LS Tanks) + 232.92 (LS Resources) = 691.11 kg
	crashTolerance = 14
	buoyancy = 1.1
	breakingForce = 250
	breakingTorque = 250
	fuelCrossFeed = True
	
	//Kapton blankets over aluminum structure
	skinTempTag = MLI
	internalTempTag = Instruments
	skinInsulationTag = True

	//	============================================================================
	//	Modules and Resources
	//	============================================================================

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = deflectorSwitch
		switcherDescription = Type
		switcherDescriptionPlural = Types
		SUBTYPE
		{
			name = Plume Deflectors
			transform = PlumeDeflectors
		}
		SUBTYPE
		{
			name = No Deflectors
		}
	}

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = roverSwitch
		switcherDescription = Variant
		switcherDescriptionPlural = Variants
		SUBTYPE
		{
			name = H Class
			transform = H_Class
		}
		SUBTYPE
		{
			name = J Class
			transform = J_Class
		}
	}

	// MODULE
	// {
		// name = ModuleB9PartSwitch
		// moduleID = meshSwitchFoil
		// switcherDescription = Foil
		// switcherDescriptionPlural = Foils
		// affectDragCubes = True
		// affectFARVoxels = True
		// SUBTYPE
		// {
			// name = Gold
		// }
		// SUBTYPE
		// {
			// name = Silver
			// TEXTURE
			// {
				// texture = ROCapsules/Assets/BDB/Apollo/Paint/Silver/bluedog_LM_Descent_Silver
				// currentTexture = bluedog_LM_Descent
			// }
			// TEXTURE
			// {
				// shaderProperty = _SpecMap
				// texture = ROCapsules/Assets/BDB/Apollo/Paint/Silver/bluedog_LM_Descent_Silver_Spec
				// currentTexture = bluedog_LM_Descent_Spec
			// }
		// }
	// }

	MODULE
	{
		name = FlagDecal
		textureQuadName = flagTransform1
	}

	MODULE
	{
		name = FlagDecal
		textureQuadName = flagTransform2
	}

	MODULE
	{
		name = ModuleFuelTanks
		type = SM-IV
		volume = 9482.98
		basemass = 0.69111

		//	Batteries ~56 kWh (28V @ 400 Ah).
		//	Four batteries for the H missions and five for J missions.
		//	H-Class: 161280 EC
		//	J-Class: 201600 EC

		TANK
		{
			name = ElectricCharge
			amount = 201600
			maxAmount = 201600
		}

		//	Capacity for ~222 kg of extra fuel for the J missions.
		//	Propellant: 19613.7 lbs
		TANK
		{
			//7,543.7 lbs main
			name = Aerozine50
			amount = 3801.96
			maxAmount = 3801.96
		}

		//	Capacity for ~355 kg of extra oxidizer for the J missions.

		TANK
		{
			//12,070.0 lbs main
			name = MON1
			amount = 3817.62
			maxAmount = 3817.62
		}
		
		TANK
		{
			name = Helium
			amount = 132575
			maxAmount = 132575
		}
	}
}

//	================================================================================
//	TAC Life Support Compatibility
//	================================================================================

@PART[ROC-LEMDescentBDB]:FOR[ROCapsules]:NEEDS[TacLifeSupport]
{
	@mass -= 0.26552	//-32.60 kg (LS Tanks) - 232.92 (LS Resources)

	@MODULE[ModuleFuelTanks]
	{
		@volume += 132.85
		@basemass -= 0.26552

		//	Two water tanks with a capacity of ~75 kg each (second tank for J missions).

		TANK
		{
			name = Water
			amount = 0
			maxAmount = 186.25
		}

		//	Two oxygen tanks with a capacity of ~22 kg each (second tank for J missions).

		TANK
		{
			name = Oxygen
			amount = 30177
			maxAmount = 30177
		}

		TANK
		{
			name = LithiumHydroxide
			amount = 2.83
			maxAmount = 2.83
		}
	}
}
